===== dts-admin 2025-10-07 13:36:00 (dts-admin-20251007-133600.log) =====
[2025-10-07 13:36] 系统端登录与鉴权收敛（统一走 Keycloak，取消前端单边放行）

[背景]
- 系统端（Admin）需保证只有“三员角色”可登录；此前前端存在白名单拦截与兜底行为，联调阶段要求完全以后端为准。

[后端约束强化]
- 登录接口强制仅三员可登录：
  - 文件：source/dts-admin/src/main/java/com/yuzhi/dts/admin/web/rest/KeycloakApiResource.java（/api/keycloak/auth/login）
  - 流程：调用 Keycloak 校验成功后，检查返回 roles，仅当包含三员（ROLE_SYS_ADMIN/ROLE_AUTH_ADMIN/ROLE_SECURITY_AUDITOR/及常见别名）时返回 200，否则 401“仅系统管理角色可登录系统端”。
  - 后续 /api/** 权限控制仍由 Spring Security 基于角色判定（双层保障）。

[前端调整]
- 取消默认前端单边角色白名单拦截：
  - 仅在设置 VITE_ENABLE_FE_GUARD=true 时启用 FE 侧拦截；默认以后台返回为准。
  - 代码：
    - source/dts-admin-webapp/src/store/userStore.ts
    - source/dts-admin-webapp/src/routes/components/login-auth-guard.tsx
- 环境文件命名规范化：
  - source/dts-admin-webapp/.env.dev → .env.development；.env.prod → .env.production
- 白名单（保留开关，不默认使用）：.env.* 中保持 VITE_ALLOWED_LOGIN_ROLES=ROLE_SYS_ADMIN,ROLE_AUTH_ADMIN,ROLE_SECURITY_AUDITOR；仅当 VITE_ENABLE_FE_GUARD=true 时生效。

[验证步骤（联调）]
1) 三员（sysadmin/authadmin/auditadmin）登录系统端 → 200；
2) 非三员（含 opadmin/普通用户）登录系统端 → 401，提示“仅系统管理角色可登录系统端”；
3) 登录后受保护 API 返回 200，携带后端下发的 token 访问。

[影响范围]
- 登录链路收敛到后端，前端仅做无 token 时的路由跳转；生产环境默认不启用 FE 角色拦截。

[注意]
- 若提示 401：优先查看 Keycloak 客户端与用户角色映射是否正确；确保 Issuer/ClientId/Secret 与运行环境一致。

