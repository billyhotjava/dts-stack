[2025-10-03 00:56] 治理与质量模块方案整理

[定位与目标]
- 治理负责制定制度化质量标准与合规要求，质量负责执行监控，形成“发现-诊断-处置”闭环，结果反哺资产目录与权限策略。

[功能分块建议]
- 质量规则库：内置空值/唯一性/参考值/阈值/自定义SQL模板，支持版本、责任人、密级。
- 质量监控中心：基于异步任务执行质量作业，展示运行进度、历史结果、告警阈值。
- 合规检查台账：法规/制度条目绑定规则集与数据集，出具批次结果与证据链。
- 问题工单与处置：自动生成整改单，跟踪状态、影响资产与处理记录。

[后端技术方案]
- 复用异步Job框架，新增 `QualityRuleRunJob`、`ComplianceCheckJob`，默认走星环 Hive/Inceptor，多源作为隐藏开关。
- 扩展治理域实体（规则/版本/批次/工单），质量结果写入 `quality_run`、`quality_run_metric` 等表，所有操作接入 `AuditService`。
- 执行轨迹与长任务事件同步记录到 `audit_event`，附件或证据沿用现有加密存储。

[前端交互设计]
- 治理导航拆分为“质量规则”“质量监控”“合规检查”“问题台账”四页，提供模板向导、执行进度、批次证据、台账视图等。
- 数据集详情与 IAM 策略页接收质量结果摘要，提示风险等级与敏感度调整建议。

[集成要点]
- 与资产目录联动：质量评分写回数据集、驱动安全视图策略。
- 与调度服务对接：支持 cron/一次性触发，失败回调生成工单。
- 默认单数据源，配置页开放隐藏开关开启多源能力；遵循公开/内部/秘密/机密密级模型。

[待确认问题]
- 合规条目来源与维护主体。
- 质量任务频率、时延及告警通道需求。
- 问题工单是否对接现有 ITSM。
- 质量指标对外共享范围与脱敏策略。
[2025-10-03 01:04] 治理与质量实施任务拆解

[后端基础]
1. Liquibase：新增治理域表(`gov_rule`, `gov_rule_version`, `gov_rule_binding`, `gov_quality_run`, `gov_quality_metric`, `gov_compliance_batch`, `gov_issue_ticket`, `gov_issue_action`)及索引视图。
2. 配置：`GovernanceProperties` 管理执行频率、重试、默认数据源、多源开关。
3. 实体与仓储：对应 JPA 实体、DTO、MapStruct 映射、Repository。

[质量规则与执行]
4. Service：`QualityRuleService` 维护规则CRUD、版本、绑定数据集，校验密级与责任人。
5. 调度：`QualityJobOrchestrator` 基于现有 `DatasetJobService` 注册 `QUALITY_RULE_RUN` job，提交执行上下文。
6. Hive执行：扩展 `HiveStatementExecutor` 支持质量检测SQL、指标聚合、异常处理。
7. 异步回调：落库运行结果(`gov_quality_run`/`gov_quality_metric`)，标记状态、耗时、错误详情，并写入 `audit_event`。

[合规检查]
8. 规则组合：`ComplianceTemplateService` 构建法规条目与质量规则映射。
9. 检查任务：`ComplianceCheckJob` 执行模板，生成批次记录与证据占位。
10. API：`GovernanceResource` 扩展 `POST /compliance-runs`、`GET /compliance-runs/{id}` 等接口，支持分页/过滤。

[问题台账]
11. Ticket模型：`IssueTicketService` 自动创建工单、流转状态、责任分配。
12. 行动记录：新增 `IssueAction` 实体记录处置动作、附件、审计。与质量/合规结果联动。

[前端治理模块]
13. 质量规则页：改造为后端驱动列表、模板向导、版本展示、执行按钮。
14. 质量监控页：新增运行历史表、趋势图、运行详情抽屉、告警高亮。
15. 合规检查页：批次列表、运行状态、证据上传入口。
16. 问题台账页：工单列表、状态筛选、指派/处置、行动时间线。
17. 全局：更新路由、导航、i18n、API请求包装、通知提示。

[集成与配置]
18. 数据集详情：展示质量评分、最近运行、合规状态。
19. IAM策略：根据质量等级给出策略建议或自动阻断。
20. 调度集成：前端提供 cron/一次性执行配置；后端调用 Foundation 调度API。
21. 多数据源开关：设置页展示多源开关，仅管理员可见。
22. 审计：所有 REST + Job 关键节点调用 `AuditService`，覆写 dts-admin 逻辑。

[测试与验证]
23. 单元测试：服务层（规则校验、执行结果聚合、工单流转）。
24. 集成测试：API flow（创建规则→执行→结果→工单）、合规批次、附件加密。
25. 前端测试：React 组件测试/关键E2E脚本（规则管理、监控、合规、台账）。
26. 文档：在 worklog/README 中补录操作手册、配置说明、手工验证步骤。

[部署前置]
27. 配置项与密钥：文档化 `governance.*`、附件加密 key、调度账号。
28. Liquibase 应用顺序：更新 master changelog，并在部署手册中加入执行顺序与回滚策略。
29. 性能与安全复核：质量任务并发、超时、失败重试策略评审。
