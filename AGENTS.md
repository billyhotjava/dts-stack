# Repository Guidelines

## Project Structure & Module Organization
- Root: `docker-compose.yml` (stack services), `imgversion.conf` (image tags), `.env` (generated by `init.sh`).
- Scripts: `init.sh` (first‑time setup), `start.sh`/`stop.sh` (lifecycle).
- Services: `services/<service>/` with `init/`, `data/`, `conf/`, optional `dynamic/`.
  - Names align with Compose service keys (e.g., `dts-trino` → `services/dts-trino/...`).
  - Examples: `services/certs/`, `services/dts-proxy/dynamic/`, `services/dts-trino/init/catalog/`.

## Build, Test, and Development Commands
- Initialize: `./init.sh single 'Strong@2025!' dts.local` — creates `.env`, certs, and starts core services.
- Start/Stop: `./start.sh [single|ha2|cluster] [service ...]`, `./stop.sh [single|ha2|cluster] [--remove-orphans]`.
- Compose helpers: `docker compose -f docker-compose.yml config` (validate), `docker compose ps` (status), `docker compose logs -f dts-trino` (tail logs).
- Spot checks: `docker compose exec dts-trino wget -qO- http://localhost:8080/v1/info`, `curl -k https://sso.${BASE_DOMAIN}`.

## Coding Style & Naming Conventions
- Shell (bash): `set -euo pipefail`; 2‑space indent; functions `lower_snake_case`; env vars `UPPER_SNAKE_CASE`.
- YAML: 2 spaces; quote strings with `:` or special chars; keep service and folder names consistent with Compose.
- Paths: service folders use kebab‑case matching the service key (e.g., `services/dts-minio/`).

## Testing Guidelines
- Rely on Compose health and logs; verify with `docker compose ps` and targeted `docker compose logs`.
- Prefer container‑local health checks for services (e.g., Trino info endpoint above).
- Keep tests lightweight; no real secrets in fixtures.

## Commit & Pull Request Guidelines
- Use Conventional Commits (`feat:`, `fix:`, `chore:`, `docs:`).
- PRs must include: summary, affected services, mode(s) tested (`single|ha2|cluster`), new/changed env vars.
- When topology changes, include `docker compose -f docker-compose.yml config --services` output.
- Add screenshots or logs for user‑visible changes.

## Security & Configuration Tips
- Do not commit real secrets. `.env` is generated by `init.sh`—sanitize before sharing.
- Image versions live in `imgversion.conf`; bump there, then rerun `./init.sh`.
- TLS certs: `services/certs/`. For production, provide CA‑signed certs and a real `BASE_DOMAIN`.

