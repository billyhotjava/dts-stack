# Repository Guidelines

## Project Structure & Module Organization
- Root: `docker-compose.yml` (stack services), `imgversion.conf` (image tags), `.env` (generated by `init.sh`).
- Scripts: `init.sh` (first‑time setup), `start.sh`/`stop.sh` (lifecycle).
- Services: `services/<service>/` with typical subfolders `init/`, `data/`, `conf/` and `dynamic/` where applicable.
  - Examples: `services/certs/`, `services/dts-proxy/dynamic/`, `services/dts-trino/init/catalog/`.
- Keep directory names aligned with Compose service keys (e.g., `dts-trino` → `services/dts-trino/...`).

## Build, Test, and Development Commands
- Initialize (creates `.env`, certs, starts services):
  - `./init.sh single 'Strong@2025!' dts.local` or run `./init.sh` interactively.
- Start/stop (optionally target a mode and specific services):
  - `./start.sh [single|ha2|cluster] [service ...]`
  - `./stop.sh  [single|ha2|cluster] [--remove-orphans]`
- Compose helpers:
  - `docker compose -f docker-compose.yml config` (validate)
  - `docker compose ps` (status)
  - `docker compose logs -f dts-trino` (tail logs)

## Coding Style & Naming Conventions
- Shell (bash): `set -euo pipefail`; 2‑space indent; functions `lower_snake_case`; env vars `UPPER_SNAKE_CASE`.
- YAML: 2 spaces; quote strings with `:` or special chars; keep service and folder names consistent with Compose.
- Paths: service folders use kebab‑case matching the service key, e.g., `services/dts-minio/`.

## Testing Guidelines
- Healthchecks: rely on Compose health status; verify with `docker compose ps` and targeted `docker compose logs`.
- Spot checks:
  - Trino: `wget -qO- http://localhost:8080/v1/info` inside container.
  - Keycloak/Traefik routes: `curl -k https://sso.${BASE_DOMAIN}`.

## Commit & Pull Request Guidelines
- Prefer Conventional Commits (`feat:`, `fix:`, `chore:`, `docs:`).
- PRs must include:
  - Summary, affected services, mode(s) tested, new/changed env vars.
  - Output of `docker compose -f docker-compose.yml config --services` when service topology changes.
  - Screenshots or logs for user‑visible changes.

## Security & Configuration Tips
- Do not commit real secrets. `.env` is generated by `init.sh`—sanitize before sharing.
- Image versions live in `imgversion.conf`; bump there, then rerun `./init.sh`.
- TLS certs: `services/certs/`. For production, provide CA‑signed certs and a real `BASE_DOMAIN`.
