# 六角色密级访问测试（零 SQL）

本用例面向手工测试人员，通过“账号登录 + 列表点击预览”的方式，验证跨域与密级访问控制是否正确，无需编写 SQL。

## 1. 测试目标与逻辑结构
- 用户身份：部门用户 / 研究所用户（数据域 = DEPT/INST）
- 角色：查看员 / 开发员 / 管理员（Owner）
- 人员密级：内部 < 秘密 < 机密
- 数据集密级：公开 < 内部 < 秘密 < 机密（DATA_PUBLIC < DATA_INTERNAL < DATA_SECRET < DATA_TOP_SECRET）
- 验证内容：
  - 登录后“数据资产列表”仅出现有权访问的数据；
  - 点击“预览”：有权则展示样例表格（LIMIT 50），越权则弹出警告。
- 禁止访问场景：
  1) 跨域数据（部门用户看研究所数据）；
  2) 高于自身密级的数据。

## 2. 测试账号（建议矩阵）
系统准备 6 个典型账号供对照测试（示例命名，实际以发放为准）：
- 部门域：`dept_viewer`（查看员）、`dept_dev`（开发员）、`dept_owner`（管理员）
- 研究所域：`inst_viewer`（查看员）、`inst_dev`（开发员）、`inst_owner`（管理员）

属性建议（供管理员在 dts-admin 中配置时参考）：
- 部门域账号需设置用户属性 `dept_code`（如 `DEPT-001`）。
- 人员密级建议：查看员=内部、开发员=秘密、管理员=机密（对应本系统映射为 GENERAL/IMPORTANT/CORE，可访问的数据级别依次递增）。
- 角色建议：
  - 部门查看员/开发员/管理员：`DEPT_DATA_VIEWER` / `DEPT_DATA_DEV` / `DEPT_DATA_OWNER`
  - 研究所查看员/开发员/管理员：`INST_DATA_VIEWER` / `INST_DATA_DEV` / `INST_DATA_OWNER`

> 登录后系统会自动识别：所属域（通过“上下文”中的作用域/部门）与人员密级；顶部右上角可查看/切换作用域（DEPT/INST）及部门。

## 3. 数据样例准备（一次性）
在“数据资产列表”页面新建两条数据（或由管理员预置）：
1) 产品明细
   - 数据域：部门（DEPT）
   - 数据密级：内部（DATA_INTERNAL）
   - 所属部门：DEPT-001（或本地实际部门编码）
   - 描述：生产产品数据
2) 设备状态
   - 数据域：研究所（INST）
   - 数据密级：机密（DATA_TOP_SECRET）
   - 共享范围：所内共享（SHARE_INST）
   - 描述：实验室设备数据

## 4. 操作路径（零 SQL）
1) 登录界面：输入系统分配的 6 个典型测试账号之一；登录成功后，系统会根据账号自动设置“作用域/部门”。
2) 数据资产列表页：
   - 列字段：序号、数据集名称、数据域（部门/研究所）、数据密级（彩色标签）、描述、操作。
   - 默认仅展示当前用户可见的数据集。
   - 点击某行“预览”：
     - 有权限：弹出对话框，顶部展示“数据集名称 + 数据密级 + 数据域”，中间为表格样例（LIMIT 50），底部显示安全提示“本数据属于【X级】，仅限授权人员查看，不得外传。”
     - 越权（高于人员密级）：顶部弹出提示“权限不足，当前密级不可访问”。
     - 跨域（部门/研究所不匹配）：顶部提示“作用域/部门不匹配，请在右上角切换上下文后重试”。

> 备注：如因上下文不当导致误判，请在右上角切换“作用域/部门”（如将 INST 切回 DEPT，或设置正确的 `dept_code`）。

## 5. 期望结果对照（基于样例数据）
以样例数据“产品明细(DEPT/内部)”与“设备状态(INST/机密)”为准：
- 部门查看员（内部）：
  - 产品明细：可见并可预览
  - 设备状态：不可见或预览时报“权限不足，当前密级不可访问”
- 部门开发员（秘密）：
  - 产品明细：可见并可预览
  - 设备状态：不可见或预览时报“权限不足，当前密级不可访问”
- 部门管理员（机密）：
  - 产品明细：可见并可预览
  - 设备状态：默认跨域不可见；若切到 INST 作用域，仍需满足密级/授权，常见为不可预览
- 研究所查看员/开发员/管理员：与上对称（INST 对本域数据可见，跨域或超密级受限）。

## 6. 问题排查指引
- 提示“作用域/部门不匹配”：右上角切换上下文（DEPT/INST、部门编码）。
- 提示“权限不足，当前密级不可访问”：说明人员密级 < 数据密级，请发起权限申请或联系管理员调整密级/角色。
- 列表为空：确认样例数据已创建且默认数据源正常（列表页右上“刷新”可同步 Inceptor 状态）。

---
验证完成后，请回填测试记录：账号、可见数据集、预览结果（成功/提示文案）、截图或时间戳，以便审计留痕。
