<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.22.xsd">

    <changeSet id="20251015-03-refactor-admin-roles-rules" author="gemini-cli">
        <comment>Refactor hardcoded role-related audit rules from AdminApiResource.java into the rule engine</comment>

        <insert tableName="audit_operation_mapping">
            <column name="url_pattern" value="/api/admin/roles"/>
            <column name="http_method" value="GET"/>
            <column name="module_name" value="角色管理"/>
            <column name="operation_type" value="READ"/>
            <column name="description_template" value="查询角色列表"/>
            <column name="source_table_template" value="角色"/>
            <column name="order_value" valueNumeric="25"/>
            <column name="enabled" valueBoolean="true"/>
        </insert>

        <insert tableName="audit_operation_mapping">
            <column name="url_pattern" value="/api/admin/custom-roles"/>
            <column name="http_method" value="GET"/>
            <column name="module_name" value="角色管理"/>
            <column name="operation_type" value="READ"/>
            <column name="description_template" value="查询自定义角色列表"/>
            <column name="source_table_template" value="角色"/>
            <column name="order_value" valueNumeric="25"/>
            <column name="enabled" valueBoolean="true"/>
        </insert>

        <insert tableName="audit_operation_mapping">
            <column name="url_pattern" value="/api/admin/custom-roles"/>
            <column name="http_method" value="POST"/>
            <column name="module_name" value="角色管理"/>
            <column name="operation_type" value="REQUEST"/>
            <column name="description_template" value="申请创建自定义角色"/>
            <column name="source_table_template" value="角色"/>
            <column name="order_value" valueNumeric="25"/>
            <column name="enabled" valueBoolean="true"/>
        </insert>

        <insert tableName="audit_operation_mapping">
            <column name="url_pattern" value="/api/admin/roles/{name}/pre-delete-check"/>
            <column name="http_method" value="GET"/>
            <column name="module_name" value="角色管理"/>
            <column name="operation_type" value="READ"/>
            <column name="description_template" value="预检查角色删除的影响: {name}"/>
            <column name="source_table_template" value="角色"/>
            <column name="param_extractors" value="{&quot;name&quot;:&quot;path.name&quot;}"/>
            <column name="order_value" valueNumeric="24"/>
            <column name="enabled" valueBoolean="true"/>
        </insert>

    </changeSet>

</databaseChangeLog>
