<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="20250929-01-explore-tables" author="codex">
        <!-- sql_connection -->
        <createTable tableName="sql_connection">
            <column name="id" type="${uuidType}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(128)">
                <constraints nullable="false"/>
            </column>
            <column name="engine" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="catalog" type="varchar(128)"/>
            <column name="schema_name" type="varchar(128)"/>
            <column name="props" type="varchar(2048)"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_date" type="timestamp"/>
            <column name="last_modified_by" type="varchar(50)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>

        <!-- query_workspace -->
        <createTable tableName="query_workspace">
            <column name="id" type="${uuidType}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(128)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(1024)"/>
            <column name="default_connection" type="varchar(64)"/>
            <column name="variables" type="varchar(2048)"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_date" type="timestamp"/>
            <column name="last_modified_by" type="varchar(50)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>

        <!-- saved_query -->
        <createTable tableName="saved_query">
            <column name="id" type="${uuidType}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="varchar(256)">
                <constraints nullable="false"/>
            </column>
            <column name="sql_text" type="clob">
                <constraints nullable="false"/>
            </column>
            <column name="engine" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="connection" type="varchar(64)"/>
            <column name="level" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="tags" type="varchar(256)"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_date" type="timestamp"/>
            <column name="last_modified_by" type="varchar(50)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>

        <!-- query_execution -->
        <createTable tableName="query_execution">
            <column name="id" type="${uuidType}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="saved_query_id" type="${uuidType}"/>
            <column name="engine" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="connection" type="varchar(64)"/>
            <column name="sql_text" type="clob">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="started_at" type="timestamp"/>
            <column name="finished_at" type="timestamp"/>
            <column name="row_count" type="bigint"/>
            <column name="bytes_processed" type="bigint"/>
            <column name="error_message" type="varchar(1024)"/>
            <column name="result_set_id" type="${uuidType}"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_date" type="timestamp"/>
            <column name="last_modified_by" type="varchar(50)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>

        <!-- result_set -->
        <createTable tableName="result_set">
            <column name="id" type="${uuidType}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="storage_uri" type="varchar(512)">
                <constraints nullable="false"/>
            </column>
            <column name="columns" type="varchar(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="row_count" type="bigint"/>
            <column name="ttl_days" type="integer"/>
            <column name="expires_at" type="timestamp"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_date" type="timestamp"/>
            <column name="last_modified_by" type="varchar(50)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>

        <!-- viz_spec -->
        <createTable tableName="viz_spec">
            <column name="id" type="${uuidType}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="varchar(256)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="config" type="varchar(4096)">
                <constraints nullable="false"/>
            </column>
            <column name="query_id" type="${uuidType}"/>
            <column name="result_set_id" type="${uuidType}"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_date" type="timestamp"/>
            <column name="last_modified_by" type="varchar(50)"/>
            <column name="last_modified_date" type="timestamp"/>
        </createTable>
    </changeSet>

</databaseChangeLog>

